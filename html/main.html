<html>
<head>
<script type="text/javascript" src="encode.js"></script>

<script>


function getPath(t,p) {
        var r = t.lastIndexOf(".")
          , e = -1 < r ? t.substr(0, r) : t;
        return [[-6, 3], [-3, 3]].map(function(t) {
            return String.prototype.substr.apply(e, t)
        }).join("/") + "/" + t + ((p.indexOf("illust") !== -1||p.indexOf("harem") !== -1) ? ".png" : ".jpg");
}

function getPath2(t) {
        var r = t.lastIndexOf(".")
          , e = -1 < r ? t.substr(0, r) : t;
        return [[-6, 3], [-3, 3]].map(function(t) {
            return String.prototype.substr.apply(e, t)
        }).join("/") + "/" + t;
}

function check() {
  var x = document.getElementById('id').value;
  var type = document.getElementById("type").value;
  var img =  document.getElementById("img");
  var p = "_0"
  if (type.indexOf("questimg_harem") !== -1)
	p="_1"
  if (x == "") {
    alert("空ID");
   
  }else{
	var Final = blowfish.encrypt(type+x+p,"bLoWfIsH",{
            outputType: 1,
            cipherMode: 0
        })
		img.src = "https://static-r.kamihimeproject.net/resources/pc/normal/"+getPath(Final,type);
		
  }
}



function check2() {
  var x = document.getElementById('pid').value;
    var type = document.getElementById("ctype").value;
	var donloadr18text = document.getElementById("check").checked;
  if (x == "") {
    alert("空ID");
   
  }else{
	var Final = blowfish.encrypt(type+x+(donloadr18text?"-S": "-H"),"bLoWfIsH",{ //
            outputType: 1,
            cipherMode: 0
        })
		var p =(donloadr18text?"/scenario/first.ks":"/scenario.json");
		document.getElementById("p").innerHTML = "https://static-r.kamihimeproject.net/scenarios/" + getPath2(Final)+p;
		document.getElementById("p").href = "https://static-r.kamihimeproject.net/scenarios/" + getPath2(Final)+p;
		document.getElementById("c").innerHTML =Final;
  }
}
function check3() {
  var x = document.getElementById('gid').value;
  if (x == "") {
    alert("空ID");
   
  }else{
	var Final = blowfish.decrypt(x,"bLoWfIsH",{ //
            outputType: 1,
            cipherMode: 0
        })
		alert(Final);
  }
}

function downloadAll(){
  var type = document.getElementById("type").value;
  var p = "_0";
  if (type.indexOf("questimg_harem") !== -1)
	p="_1";
	
	for(var i = 5000;i!== 8000;++i){
		var Final = blowfish.encrypt(type+i+p,"bLoWfIsH",{
            outputType: 1,
            cipherMode: 0
        })
		var oImg=document.createElement("img");
		oImg.src = "https://static-r.kamihimeproject.net/resources/pc/normal/"+getPath(Final,type);
	}

}

</script>
</head>
<body>
<h1>Kamihime (DMM)游戏资源 BlowFish 解算器 (by imgrenko)</h1>
<h2>这啥玩意？</h2>
<h4>解包过Kamihime的立绘过吗？注意到文件名都是一堆乱码吗？此页面可以帮助你把乱码翻译回来，如此一来只需要知道角色对应的ID，就可以定位资源了，从而解包。</h4>
<h2>有对应繁中，英语的版本吗？</h2>
<h4>没有，但提取原理可能相同，你可以更改此页面文件实现，但有一个麻烦的问题是BlowFish的密匙很可能各版本都不相同</h4>
<hr>

调试用密文：<input type="text" id="gid">  <button onclick="check3()">提交</button>
<hr>
剧情文本路径计算：<input type="text" id="pid">  
<select name="Select1" id="ctype">
		<option value="character_">神姬</option>
		<option value="summon_">幻兽</option>
		<option value="job_">英灵</option>
	</select>
<input type="checkbox" id="check" >读取非R18文本</input>
<button onclick="check2()">提交</button>
<br>这里要写角色Id+场景ID-2，因此不能填四位数，要写场景序号，例如要提取角色[紅醇麗姫]ティシュトリヤ的H CG场景在这里可以写5163-3-2（因为她对应的角色ID是5163，后面的-2每个角色都有 要保留下来），如果ID不正确可能会有404问题，或者找到文件对应的不是你想要的角色，修改数值多试几次。最后推荐右键保存json文件<br>
<hr>
<a href="" id="p">scenarios json</a>
<br>
数据文件夹名称（如果是R18文本，将其填入H Scene查阅器可以直接查阅该角色的H Scene内容）：<a id="c"></a>
<hr>
<h3>不勾选读取非R18文本，点击提交按钮得到一个json文件链接，这个json文件有什么用？</h3>
这个json文件描述了H场景的所有内容，使用此json文件作为索引，可以拿到H场景有关的所有CG，文本以及语音。拥有了这些数据就可以制作一个H场景阅读器，离线阅读，不用跑DMM登录kamihime了。（但是这个json文件不是标准的，相对于标准json有语法错误，需要修改后才能在一些要求极其严格的json插件中使用）
<h3>勾选读取非R18文本，点击提交按钮得到一个ks文件链接，这个ks文件有什么用？</h3>
ks文件是kamihime用于读取剧情的文本，其中有语音，立绘文件的相关路径信息，要下载立绘，使用下面的链接
https://static-r.kamihimeproject.net/scenarios/fgimage/ks文件内的storage字段。<br>
要下载立绘，使用下面的链接
https://static-r.kamihimeproject.net/xxx/xxx/角色数据文件夹/sound/ks文件内playse storage字段。
<hr>
<h3>怎么样才能得到角色的ID？</h3>
打开PC端游戏，随便点开一个ガチャ界面，然后中打开F12，然后选择开发工具的Network（在开发工具窗口的上侧），然后回到游戏按下“ガチャ详细”按钮，找到你感兴趣的角色，待角色详细信息面板加载完毕后，回到开发工具，寻找文件名只有三四位数的文件，那就是角色ID。
<hr>
  填入角色ID：<input type="text" id="id">
  <select name="Select1" id="type">
		<option value="corecard_chara_">神姬图标</option>
		<option value="corecard_summon_">幻兽图标</option>
		<option value="corecard_job_">英灵图标</option>
		<option value="illust-com-kneeshot_chara_">神姬立绘</option>
		<option value="illust-com-kneeshot_summon_">幻兽立绘</option>
		<option value="illust-com-kneeshot_job_">英灵立绘</option>
		<option value="illustzoom_chara_">神姬立绘全身</option>
		<option value="illustzoom_summon_">幻兽立绘全身</option>
		<option value="illustzoom_job_">英灵立绘全身</option>
		<option value="questimg_harem-chara-quest_">神姬H场景缩略图</option>
		<option value="questimg_harem-summon-quest_">幻兽H场景缩略图</option>
		<option value="questimg_harem-job-quest_">英灵H场景缩略图</option>
	</select>
  <button onclick="check()">提交</button>
 
  <br>少于四位数的id要在前边用0填充，例如你要填写的ID为19，不能直接写19，要写0019。下以角色[紅醇麗姫]ティシュトリヤ为示例讲述这里的功能用法，她对应的角色ID是5163，那在选择框选择她对应的种类，她属于神姬，那就选择神姬相关的类别，然后在文本框填入5163，点击提交即可。但需要注意，如果你要查看H场景缩略图，那么必须带上场景ID和固定字符“-2”，例如要查看[紅醇麗姫]ティシュトリヤ的H场景缩略图，要填写5163-3-2，其中3是场景ID，也可以填2。这个数值也可以填到上方的H文件夹路径文本框中。
  <br>
  <hr>
  <img src="" id ="img">
</body>
</html>
